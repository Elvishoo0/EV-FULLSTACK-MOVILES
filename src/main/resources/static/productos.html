<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Productos</title>

  <!-- Tu hoja de estilos -->
  <link rel="stylesheet" href="/css/main.css?v=1">

  <style>
    /* Estilos mínimos de la grilla tipo marketplace */
    .alix-wrap { width:min(1100px,95%); margin: 100px auto 40px; }
    .alix-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:14px; }
    .alix-card { background:#fff; border:1px solid #eee; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; }
    .alix-title { font-weight:700; }
    .alix-price { font-weight:700; opacity:.95; }
    .alix-add { cursor:pointer; border:none; border-radius:10px; padding:10px 12px; font-weight:700; background:#2E8B57; color:#fff; }
  </style>

  <!-- Usa el mismo host del backend para evitar CORS -->
  <script> window.API_BASE = '/api'; </script>
</head>
<body>
  <div class="alix-wrap">
    <h2>Productos</h2>
    <div id="alix-grid" class="alix-grid" aria-live="polite"></div>
  </div>

  <script>
    const CLP = new Intl.NumberFormat('es-CL', { style:'currency', currency:'CLP', maximumFractionDigits:0 });
    const mount = document.getElementById('alix-grid');

    // Carrito simple en localStorage
    let cart = JSON.parse(localStorage.getItem('hh_cart')||'{}');
    const save = ()=>localStorage.setItem('hh_cart', JSON.stringify(cart));
    const addToCart = id => { cart[id] = (cart[id]||0) + 1; save(); };

    // Render de tarjetas: [Nombre] [Precio] [Agregar]
    function render(list){
      mount.innerHTML = '';
      list.forEach(p=>{
        const el = document.createElement('article');
        el.className = 'alix-card';
        el.dataset.id = p.id;
        el.innerHTML = `
          <div class="alix-title">${p.nombre}</div>
          <div class="alix-price">${CLP.format(Number(p.precio)||0)}</div>
          <button class="alix-add" type="button">Agregar al carrito</button>
        `;
        el.querySelector('.alix-add').addEventListener('click', ()=> addToCart(p.id));
        mount.appendChild(el);
      });
    }

    // Trae productos desde tu API Java/Mongo
    fetch(`${window.API_BASE}/productos`)
      .then(r=>{ if(!r.ok) throw new Error(r.status); return r.json(); })
      .then(data=> render(data))
      .catch(err=>{
        console.error('Error cargando /api/productos', err);
        mount.innerHTML = '<p>No se pudo cargar el catálogo. Reintenta más tarde.</p>';
      });
  </script>
</body>
</html>
